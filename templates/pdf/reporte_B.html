<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>RCT - Reporte #{{ r.id }}</title>
    <link rel="stylesheet" href="static/css/pdf_B.css">

    <style>
        html {
            string-set: pdf_mina "{{ r.mina|default('') }}";
            string-set: pdf_fecha "{{ r.fecha|default('') }}";
            string-set: pdf_turno "{{ r.turno|default('') }}";
            string-set: pdf_estado "{{ r.estado|default('') }}";
            string-set: pdf_id "{{ r.id }}";
            string-set: pdf_generado "{{ generado_en|default('') }}";
        }

        @page {
            size: A4 landscape;
            margin: 12mm 10mm 12mm 10mm;
        }
    </style>
</head>

<body>

{% set sin_novedades = [] %}

{# =========================
   HEADER
========================= #}

{% set turno_raw = (r.turno|default('')|lower) %}
{% set turno_abbr = 'D' if ('dia' in turno_raw or 'día' in turno_raw or turno_raw == 'd') else 'N' %}

{% set mina_raw = (r.mina|default('')|upper) %}
{% set mina_abbr = 'ED' if ('ED' in mina_raw or 'DESCANSO' in mina_raw) else ('PB' if ('PB' in mina_raw or 'PRIBBENOW' in mina_raw) else mina_raw) %}

<div class="page-header">
    <div class="header-inner">
        <div class="hdr-left">
            <img class="hdr-logo" src="static/img/logo.png" alt="Logo">
        </div>
        <div class="hdr-center">
            <div class="hdr-title">Reporte de Cambio de Turno</div>
        </div>
        <div class="hdr-right">
            <div class="hdr-meta">
                <span class="hdr-item">{{ r.fecha }}</span>
                <span class="hdr-sep">|</span>
                <span class="hdr-item">Turno {{ turno_abbr }}</span>
                <span class="hdr-sep">|</span>
                <span class="hdr-item">Mina {{ mina_abbr }}</span>
            </div>
        </div>
    </div>
</div>

{# =========================================================
   BLOQUES PRINCIPALES (SIN CAMBIOS)
========================================================= #}

{# --- AQUÍ VA TODO TU CONTENIDO ACTUAL SIN CAMBIOS --- #}
{# Operación, Camiones, Equipo liviano, Personal, Gestión, etc. #}

{# =========================================================
   SEGURIDAD
========================================================= #}

{% if seguridad_obs|length == 0 %}
    {% set _ = sin_novedades.append('Observaciones') %}
{% endif %}

{% if seguridad_charlas|length == 0 %}
    {% set _ = sin_novedades.append('Charlas') %}
{% endif %}

{% if seguridad_obs|length > 0 or seguridad_charlas|length > 0 %}
<section class="section">
    <div class="two-col">

        {% if seguridad_obs|length > 0 %}
        <div class="card subcard">
            <div class="subhead">Observaciones</div>
            <table class="table table-compact">
                <thead>
                    <tr>
                        <th>Lugar</th>
                        <th>Hallazgos</th>
                        <th class="t-center">Divulgada</th>
                    </tr>
                </thead>
                <tbody>
                    {% for x in seguridad_obs %}
                    <tr>
                        <td>{{ x.lugar }}</td>
                        <td>{{ x.hallazgos }}</td>
                        <td class="t-center">
                            <span class="pill {{ 'pill-ok' if x.divulgada == 1 else 'pill-no' }}">
                                {{ 'Sí' if x.divulgada == 1 else 'No' }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if seguridad_charlas|length > 0 %}
        <div class="card subcard">
            <div class="subhead">Charlas</div>
            <table class="table table-compact">
                <thead>
                    <tr>
                        <th>Tema</th>
                        <th class="t-right">Personas</th>
                        <th>Lugar</th>
                    </tr>
                </thead>
                <tbody>
                    {% for x in seguridad_charlas %}
                    <tr>
                        <td>{{ x.tema }}</td>
                        <td class="t-right">{{ x.personas }}</td>
                        <td>{{ x.lugar }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

    </div>
</section>
{% endif %}

{# =========================================================
   PTS / COMENTARIOS
========================================================= #}

{% if not pts %}
    {% set _ = sin_novedades.append('Divulgación del PTS') %}
{% endif %}

{% if comentarios|length == 0 %}
    {% set _ = sin_novedades.append('Comentarios') %}
{% endif %}

{% if pts or comentarios|length > 0 %}
<section class="section">
    <div class="two-col">

        {% if pts %}
        <div class="card subcard">
            <div class="subhead">Divulgación PTS</div>
            <div class="text-block soft-text">{{ pts.texto }}</div>
        </div>
        {% endif %}

        {% if comentarios|length > 0 %}
        <div class="card subcard">
            <div class="subhead">Comentarios del turno</div>
            <ul class="bullets bullets-soft">
                {% for c in comentarios %}
                <li>{{ c.comentario }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

    </div>
</section>
{% endif %}

{# =========================================================
   COMPLEMENTARIOS
========================================================= #}

{% if bombas|length == 0 and luminarias|length == 0 %}
    {% set _ = sin_novedades.append('Complementarios (Bombas y Luminarias)') %}
{% endif %}

{# =========================================================
   CARD FINAL: SECCIONES SIN NOVEDADES
========================================================= #}

{% if sin_novedades|length > 0 %}
<section class="section">
    <div class="two-col">

        <div></div>

        <div class="card subcard">
            <div class="subhead">Secciones sin novedades</div>
            <div class="two-col">
                <ul class="bullets bullets-soft">
                    {% for s in sin_novedades[:(sin_novedades|length // 2 + sin_novedades|length % 2)] %}
                    <li>{{ s }}</li>
                    {% endfor %}
                </ul>
                <ul class="bullets bullets-soft">
                    {% for s in sin_novedades[(sin_novedades|length // 2 + sin_novedades|length % 2):] %}
                    <li>{{ s }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

    </div>
</section>
{% endif %}

</body>
</html>
