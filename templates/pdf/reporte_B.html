<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>RCT - Reporte #{{ r.id }}</title>
    <link rel="stylesheet" href="static/css/pdf_B.css">

    <style>
        html {
            string-set: pdf_mina "{{ r.mina|default('') }}";
            string-set: pdf_fecha "{{ r.fecha|default('') }}";
            string-set: pdf_turno "{{ r.turno|default('') }}";
            string-set: pdf_estado "{{ r.estado|default('') }}";
            string-set: pdf_id "{{ r.id }}";
            string-set: pdf_generado "{{ generado_en|default('') }}";
        }

        @page {
            size: A4 landscape;
            margin: 12mm 10mm 12mm 10mm;
        }
    </style>
</head>

<body>

    {# ================= HEADER ================= #}
    {% set turno_raw = (r.turno|default('')|lower) %}
    {% set turno_abbr = 'D' if ('dia' in turno_raw or 'día' in turno_raw or turno_raw == 'd') else 'N' %}
    {% set mina_raw = (r.mina|default('')|upper) %}
    {% set mina_abbr = 'ED' if 'ED' in mina_raw else ('PB' if 'PB' in mina_raw else mina_raw) %}

    {% set supervisores_txt = supervisores | map(attribute="supervisor") | unique | join(', ') if supervisores else ''
    %}

    <div class="page-header">
        <div class="header-inner">
            <div class="hdr-left">
                <img class="hdr-logo" src="static/img/logo.png">
            </div>
            <div class="hdr-center">
                <div class="hdr-title">Reporte de Cambio de Turno</div>
            </div>
            <div class="hdr-right">
                <div class="hdr-meta">
                    {{ r.fecha }} | Turno {{ turno_abbr }} | Mina {{ mina_abbr }}
                    {% if supervisores_txt %} | {{ supervisores_txt }}{% endif %}
                </div>
            </div>
        </div>
    </div>

    {# ================= OPERACIÓN ================= #}
    <section class="rct-section" id="operacion">
        <div class="op-two-col">

            <div class="op-col">
                <div class="card subcard">
                    <div class="subhead">Operación del turno</div>

                    <div class="mini-kpi-row mini-kpi-4">
                        <div class="mini-kpi">
                            <div class="mini-kpi-label">Inicio Pit 2</div>
                            <div class="mini-kpi-value">{{ operacion.inicio_pit2 or '—' }}</div>
                        </div>
                        <div class="mini-kpi">
                            <div class="mini-kpi-label">Inicio Pit 5</div>
                            <div class="mini-kpi-value">{{ operacion.inicio_pit5 or '—' }}</div>
                        </div>
                        <div class="mini-kpi">
                            <div class="mini-kpi-label">Final Pit 2</div>
                            <div class="mini-kpi-value">{{ operacion.final_pit2 or '—' }}</div>
                        </div>
                        <div class="mini-kpi">
                            <div class="mini-kpi-label">Final Pit 5</div>
                            <div class="mini-kpi-value">{{ operacion.final_pit5 or '—' }}</div>
                        </div>
                    </div>

                    <div class="op-note">
                        <div class="k">Camiones x Operador</div>
                        <div class="v">{{ operacion.camiones_por_operador or '—' }}</div>
                    </div>
                </div>
            </div>

            <div class="op-col">
                <div class="card subcard">
                    <div class="subhead">Llegada de buses a bahías</div>
                    {% include "pdf/partials/bahias_split.html" %}
                </div>
            </div>

        </div>
    </section>

    {# ================= CAMIONES + LIVIANO ================= #}
    <section class="section" id="bloque-camiones-liviano">
        <div class="two-col">

            <div class="card" id="dist-camiones">
                <div class="section-title">
                    <h2 class="h2">Distribución de camiones</h2>
                    <span class="badge">{{ total_camiones }} camiones</span>
                </div>
                {% include "pdf/partials/dist_camiones.html" %}
            </div>

            <div class="card" id="equipo-liviano">
                <div class="section-title">
                    <h2 class="h2">Equipo liviano</h2>
                    <span class="badge">Disponible {{ equipo_liviano|length }}</span>
                </div>
                {% include "pdf/partials/equipo_liviano.html" %}
            </div>

        </div>
    </section>

    {# ================= PERSONAL ================= #}
    <section class="section" id="personal">
        {% include "pdf/partials/personal.html" %}
    </section>

    {# ================= GESTIÓN DE ÁREAS (MOVIDA AQUÍ) ================= #}
    <section class="section" id="gestion-areas">
        <div class="section-title">
            <h2 class="h2">Gestión de áreas</h2>
            <span class="badge">{{ gestion|length }} registros</span>
        </div>

        <div class="card">
            {% include "pdf/partials/gestion_areas.html" %}
        </div>
    </section>

    {# ================= VARADOS + COMPLEMENTARIOS ================= #}
    <section class="section" id="bloque-3-dos-columnas">
        <div class="two-col">

            <div class="card" id="equipos-varados">
                <div class="section-title">
                    <h2 class="h2">Equipos varados en campo</h2>
                    <span class="badge">{{ equipos|length }} equipos</span>
                </div>
                {% include "pdf/partials/equipos_varados.html" %}
            </div>

            <div class="card" id="complementarios-mini">
                <div class="section-title">
                    <h2 class="h2">Complementarios</h2>
                    <span class="badge">Bombas {{ bombas|length }} · Luminarias {{ luminarias|length }}</span>
                </div>
                {% include "pdf/partials/complementarios.html" %}
            </div>

        </div>
    </section>

    {# ================= SEGURIDAD ================= #}
    <section class="section" id="seguridad">
        {% include "pdf/partials/seguridad.html" %}
    </section>

    {# ================= PTS + COMENTARIOS ================= #}
    <section class="section" id="pts-comentarios">
        {% include "pdf/partials/pts_comentarios.html" %}
    </section>

</body>

</html>