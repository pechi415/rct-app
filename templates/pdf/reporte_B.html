<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>RCT - Reporte #{{ r.id }}</title>
    <link rel="stylesheet" href="static/css/pdf_B.css">

    <style>
        html {
            string-set: pdf_mina "{{ r.mina|default('') }}";
            string-set: pdf_fecha "{{ r.fecha|default('') }}";
            string-set: pdf_turno "{{ r.turno|default('') }}";
            string-set: pdf_estado "{{ r.estado|default('') }}";
            string-set: pdf_id "{{ r.id }}";
            string-set: pdf_generado "{{ generado_en|default('') }}";
        }

        @page {
            size: A4 landscape;
            margin: 12mm 10mm 12mm 10mm;
        }
    </style>
</head>

<body>

{% set sin_novedades = [] %}

<!-- ================= HEADER ================= -->
{% set turno_raw = (r.turno|default('')|lower) %}
{% set turno_abbr = 'D' if ('dia' in turno_raw or 'día' in turno_raw or turno_raw == 'd') else 'N' %}
{% set mina_raw = (r.mina|default('')|upper) %}
{% set mina_abbr = 'ED' if ('ED' in mina_raw or 'DESCANSO' in mina_raw) else ('PB' if ('PB' in mina_raw or 'PRIBBENOW' in mina_raw) else mina_raw) %}
{% set supervisores_txt = supervisores | map(attribute="supervisor") | unique | join(', ') if supervisores else '' %}

<div class="page-header">
    <div class="header-inner">
        <div class="hdr-left">
            <img class="hdr-logo" src="static/img/logo.png">
        </div>
        <div class="hdr-center">
            <div class="hdr-title">Reporte de Cambio de Turno</div>
        </div>
        <div class="hdr-right">
            <div class="hdr-meta">
                <span>{{ r.fecha }}</span> |
                <span>Turno {{ turno_abbr }}</span> |
                <span>Mina {{ mina_abbr }}</span>
                {% if supervisores_txt %}| {{ supervisores_txt }}{% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ================= TODO TU CONTENIDO ORIGINAL ================= -->
<!-- (NO SE TOCA NADA DE TUS SECTIONS EXISTENTES) -->

{{ super() }}

<!-- ================= SECCIONES SIN NOVEDADES ================= -->

{% if seguridad_obs|length == 0 %}
{% set _ = sin_novedades.append('Observaciones') %}
{% endif %}

{% if seguridad_charlas|length == 0 %}
{% set _ = sin_novedades.append('Charlas') %}
{% endif %}

{% if comentarios|length == 0 %}
{% set _ = sin_novedades.append('Comentarios') %}
{% endif %}

{% if entrenamiento_items|length == 0 %}
{% set _ = sin_novedades.append('Personal en entrenamiento') %}
{% endif %}

{% if contactos|length == 0 %}
{% set _ = sin_novedades.append('Contacto con operadores') %}
{% endif %}

{% if not pts or not (pts["texto"] if pts is mapping else pts.texto) %}
{% set _ = sin_novedades.append('Divulgación PTS') %}
{% endif %}

{% if bombas|length == 0 and luminarias|length == 0 %}
{% set _ = sin_novedades.append('Complementarios') %}
{% endif %}

{% if sin_novedades|length > 0 %}
<section class="section">
    <div class="two-col">
        <div class="card subcard">
            <div class="subhead">Secciones sin novedades</div>
            <table class="table table-compact">
                <tbody>
                    {% for i in range(0, sin_novedades|length, 2) %}
                    <tr>
                        <td>{{ sin_novedades[i] }}</td>
                        <td>
                            {% if i+1 < sin_novedades|length %}
                                {{ sin_novedades[i+1] }}
                            {% else %}
                                —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div></div>
    </div>
</section>
{% endif %}

</body>
</html>
