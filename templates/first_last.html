{% extends "base.html" %}
{% block title %}First - Last{% endblock %}

{% block content %}

<!-- =======================
     HEADER: T√çTULO + NAV REPORTE
======================= -->
<div class="d-flex justify-content-between align-items-center gap-3 mb-2">
  <div>
    <h1 class="mb-1">First - Last</h1>
    <div class="text-muted">
      Reporte #{{ r.id }} | {{ r.fecha }} | {{ r.turno }} | {{ r.mina }} | Estado: {{ r.estado }}
    </div>
  </div>

  {% include "_nav_reporte.html" %}
</div>

<!-- =======================
     MENSAJES
======================= -->
{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

{% if r.estado == "CERRADO" %}
<div class="alert alert-warning">
  Este reporte est√° cerrado. No se puede editar.
</div>
{% endif %}

<!-- =========================================================
     FORM: CREAR (solo si NO existe registro)
     Nota UX: valores no obligatorios, si no se ingresan => "Sin registros" en PDF/tablas
========================================================= -->
{% if not item %}

<form method="POST" class="card card-body mb-3">

  <h5 class="mb-2">Arribo a palas - Inicio de turno</h5>
  <div class="row g-2 mb-3">
    <div class="col-md-6">
      <label class="form-label">Pit 2 (hora)</label>
      <input class="form-control" type="text" name="inicio_pit2" placeholder="Ej: 05:42"
        value="{{ request.form.get('inicio_pit2','') }}">
      <div class="form-text">Opcional. Formato sugerido: HH:MM.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Pit 5 (hora)</label>
      <input class="form-control" type="text" name="inicio_pit5" placeholder="Ej: 18:25"
        value="{{ request.form.get('inicio_pit5','') }}">
      <div class="form-text">Opcional. Formato sugerido: HH:MM.</div>
    </div>
  </div>

  <h5 class="mb-2">Arribo a palas - Final de turno</h5>
  <div class="row g-2 mb-3">
    <div class="col-md-6">
      <label class="form-label">Pit 2 (hora)</label>
      <input class="form-control" type="text" name="final_pit2" placeholder="Ej: 05:25"
        value="{{ request.form.get('final_pit2','') }}">
      <div class="form-text">Opcional. Formato sugerido: HH:MM.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Pit 5 (hora)</label>
      <input class="form-control" type="text" name="final_pit5" placeholder="Ej: 18:56"
        value="{{ request.form.get('final_pit5','') }}">
      <div class="form-text">Opcional. Formato sugerido: HH:MM.</div>
    </div>
  </div>

  <h5 class="mb-2">Camiones por operador (1ra hora)</h5>
  <div class="row g-2">
    <div class="col-md-4">
      <label class="form-label">Cantidad (entero)</label>
      <input class="form-control" type="number" name="camiones_por_operador" min="0" step="1" placeholder="Ej: 2"
        value="{{ request.form.get('camiones_por_operador','') }}">
      <div class="form-text">Opcional. Si no registras nada, se asumir√° ‚ÄúSin registros‚Äù.</div>
    </div>

    <div class="col-md-8">
      <label class="form-label">Raz√≥n</label>
      <input class="form-control" type="text" name="razon" placeholder="Ej: falta de operadores"
        value="{{ request.form.get('razon','') }}">
      <div class="form-text">Opcional (pero si ingresas cantidad &gt; 0, conviene indicar la raz√≥n).</div>
    </div>
  </div>

  {% if r.estado != "CERRADO" %}
  <div class="mt-3">
    <button class="btn btn-primary" type="submit">üíæ Guardar</button>
  </div>
  {% endif %}

</form>

{% endif %}

<!-- =========================================================
     TABLA: REGISTRO (si existe) + ACCIONES
     Nota: si un campo viene vac√≠o => mostrar "Sin registros"
========================================================= -->
{% if item %}
<div class="card">
  <div class="card-header fw-bold">Registro guardado</div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead class="table-dark">
          <tr>
            <th>Inicio Pit 2</th>
            <th>Inicio Pit 5</th>
            <th>Final Pit 2</th>
            <th>Final Pit 5</th>
            <th>Cam. x Operador</th>
            <th>Raz√≥n</th>
            <th style="width:220px;">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>{{ item.inicio_pit2 or 'Sin registros' }}</td>
            <td>{{ item.inicio_pit5 or 'Sin registros' }}</td>
            <td>{{ item.final_pit2 or 'Sin registros' }}</td>
            <td>{{ item.final_pit5 or 'Sin registros' }}</td>
            <td>
              {% if item.camiones_por_operador is not none and item.camiones_por_operador != '' %}
              {{ item.camiones_por_operador }}
              {% else %}
              Sin registros
              {% endif %}
            </td>
            <td>{{ item.razon or 'Sin registros' }}</td>

            <td class="acciones-td">
              <div class="d-flex gap-1 align-items-center">
                {% if r.estado == "CERRADO" %}
                <span class="reporte-cerrado">Reporte cerrado</span>
                {% else %}
                <a class="btn btn-sm btn-outline-primary" href="/reportes/{{ r.id }}/first_last/editar">
                  ‚úèÔ∏è Editar
                </a>

                <form method="POST" action="/reportes/{{ r.id }}/first_last/eliminar" class="m-0">
                  <button class="btn btn-sm btn-outline-danger" onclick="return confirm('¬øEliminar este registro?');">
                    üóë Eliminar
                  </button>
                </form>
                {% endif %}
              </div>
            </td>

          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endif %}

{% endblock %}